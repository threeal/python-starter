pre-commit:
  piped: true
  jobs:
    - name: install dependencies
      run: poetry install --with dev
      glob:
        - poetry.lock
        - poetry.toml
        - pyproject.toml

    - name: fix formatting
      run: poetry run ruff format
      glob:
        - "*.py"
        - poetry.lock
        - pyproject.toml

    - name: fix lint
      run: poetry run ruff check --fix
      glob:
        - "*.py"
        - poetry.lock
        - pyproject.toml

    - name: check diff
      run: git diff --exit-code {staged_files}
